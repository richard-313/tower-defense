// --- START OF FILE translations.js ---
const translations = {
    en: {
        "game.title": "Medieval Defense",
        // UI Elements
        "ui.lives": "Lives",
        "ui.gold": "Gold",
        "ui.wave": "Wave",
        "ui.waveReady": "Ready",
        "ui.waveStart": "Start Wave",
        "ui.map": "Map",
        "ui.language": "Language",
        "ui.save": "Save Game",
        "ui.load": "Load Game",
        "ui.help": "Help",
        "ui.close": "Close",
        "ui.sell": "Sell",
        "ui.upgrade": "Upgrade",
        "ui.maxLevel": "Max Level",
        "ui.cost": "Cost",
        "ui.sellValue": "Sell Value",
        "ui.towerInfo": "Tower Info",
        "ui.currentLevel": "Level",
        "ui.confirm": "Confirm",
        "ui.cancel": "Cancel",
        "ui.cannotAfford": "Too expensive",
        "ui.tower": "Tower",
        "ui.stats": "Stats",
        "ui.damage": "Damage",
        "ui.range": "Range",
        "ui.fireRate": "Fire Rate",
        "ui.slowdown": "Slowdown",
        "ui.duration": "Duration",
        "ui.splashRadius": "Splash Radius",
        "ui.targets": "Targets",
        "ui.chainRange": "Chain Range",
        "ui.pierce": "Pierce",
        "ui.perSecond": "/s",

        // Map Names
        "map.map1.name": "Green Valley",
        "map.map2.name": "Rocky Pass",
        "map.map3.name": "Swampland",

        // Tower Names & Descriptions (Add keys for descriptions if needed)
        "tower.basic.name": "Basic Tower",
        "tower.sniper.name": "Sniper Tower",
        "tower.slow.name": "Frost Tower",
        "tower.bomb.name": "Bomb Tower",
        "tower.lightning.name": "Lightning Tower",
        "upgrade.basic.0.name": "Double Shot",
        "upgrade.basic.1.name": "Rapid Fire",
        "upgrade.basic.2.name": "Assault Cannon",
        "upgrade.sniper.0.name": "Reinforced Shot",
        "upgrade.sniper.1.name": "Precision Boost",
        "upgrade.sniper.2.name": "Piercing Rounds",
        "upgrade.slow.0.name": "Stronger Slow",
        "upgrade.slow.1.name": "Extended Slow",
        "upgrade.slow.2.name": "Deep Freeze",
        "upgrade.bomb.0.name": "Wider Blast",
        "upgrade.bomb.1.name": "Heavy Ordinance",
        "upgrade.bomb.2.name": "Cluster Bomb", // Renamed for clarity
        "upgrade.lightning.0.name": "Chain Lightning",
        "upgrade.lightning.1.name": "Triple Bolt",
        "upgrade.lightning.2.name": "Thunder Storm",

        // Enemy Names
        "enemy.normal.name": "Peasant",
        "enemy.fast.name": "Scout",
        "enemy.tank.name": "Knight",
        "enemy.boss.name": "Warlord",
        "enemy.immune.name": "Sorcerer",
        "enemy.regen.name": "Cleric",

        // Popups / Alerts
        "alert.invalidSaveData.title": "Load Error",
        "alert.invalidSaveData.body": "Invalid save data found. Save file might be corrupted.",
        "alert.loadError.title": "Load Error",
        "alert.loadError.body": "Error loading game: ", // Append error message
        "alert.noSave.title": "Load Game",
        "alert.noSave.body": "No saved game found.",
        "alert.saveSuccess.title": "Game Saved",
        "alert.saveSuccess.body": "Game saved successfully!",
        "alert.saveError.title": "Save Error",
        "alert.saveError.body": "Error saving game: ", // Append error message
        "alert.loadSuccess.title": "Game Loaded",
        "alert.loadSuccess.body": "Game loaded successfully!",
        "alert.gameOver.title": "Game Over!",
        "alert.gameOver.body": "You reached wave {waveNumber}.",
        "alert.cannotPlaceTower.title": "Placement Error",
        "alert.cannotPlaceTower.body": "Cannot place tower here!",
        "alert.notEnoughGold.title": "Not Enough Gold",
        "alert.notEnoughGold.body": "You don't have enough gold for this tower.",
        "alert.cannotSwitchMap.title": "Map Change Blocked",
        "alert.cannotSwitchMap.body": "Cannot switch map during an active wave!",
        "alert.upgradeFailed.title": "Upgrade Failed",
        "alert.upgradeFailed.body": "Upgrade failed or not possible.",


        // Help Popup
        "help.title": "How to Play",
        "help.close": "Close",
        "help.goal.title": "Goal",
        "help.goal.body": "Prevent enemies from reaching the end of the path! Place towers strategically to defeat them.",
        "help.controls.title": "Controls",
        "help.controls.body": "<b>Click empty tile:</b> Open tower building menu.<br><b>Click tower:</b> Open upgrade/sell panel.<br><b>Right-click / Click outside menus:</b> Close menus.",
        "help.resources.title": "Resources",
        "help.resources.body": "<b>{goldIcon} Gold:</b> Earned by defeating enemies and completing waves. Used to build and upgrade towers.<br><b>{livesIcon} Lives:</b> Lost when an enemy reaches the end. Game over when lives reach 0.",
        "help.waves.title": "Waves",
        "help.waves.body": "Click 'Start Wave' to begin the next enemy wave. After a wave is cleared, the next one starts automatically after a short countdown.",
        "help.towers.title": "Towers",
        "help.enemies.title": "Enemies",
        "help.saveLoad.title": "Save/Load",
        "help.saveLoad.body": "Use the 'Save Game' and 'Load Game' buttons in the header menu to manage your progress.",

        // Tower help descriptions (use keys from towerTypes.js)
        "help.tower.basic.desc": "Balanced attacker. Upgrades add more shots or faster firing.",
        "help.tower.sniper.desc": "High damage, long range, slow fire rate. Upgrades increase damage, range, and eventually pierce targets.",
        "help.tower.slow.desc": "Slows enemies and deals minor damage. Upgrades increase slow strength and duration.",
        "help.tower.bomb.desc": "Deals area-of-effect (splash) damage. Upgrades increase damage and blast radius.",
        "help.tower.lightning.desc": "Fires lightning that chains to nearby enemies. Upgrades hit more targets.",

        // Enemy help descriptions (use keys from enemyTypes.js)
        "help.enemy.normal.desc": "Standard enemy.",
        "help.enemy.fast.desc": "Moves quickly, lower health.",
        "help.enemy.tank.desc": "Slow but very high health.",
        "help.enemy.boss.desc": "Very strong, appears on specific waves.",
        "help.enemy.immune.desc": "Cannot be slowed by Frost Towers.",
        "help.enemy.regen.desc": "Slowly heals itself over time.",

    },
    de: {
        "game.title": "Medieval Defense",
        // UI Elements
        "ui.lives": "Leben",
        "ui.gold": "Gold",
        "ui.wave": "Welle",
        "ui.waveReady": "Bereit",
        "ui.waveStart": "Welle starten",
        "ui.map": "Karte",
        "ui.language": "Sprache",
        "ui.save": "Speichern",
        "ui.load": "Laden",
        "ui.help": "Hilfe",
        "ui.close": "Schließen",
        "ui.sell": "Verkaufen",
        "ui.upgrade": "Upgrade",
        "ui.maxLevel": "Max Level",
        "ui.cost": "Kosten",
        "ui.sellValue": "Verkaufswert",
        "ui.towerInfo": "Turm-Info",
        "ui.currentLevel": "Level",
        "ui.confirm": "Bestätigen",
        "ui.cancel": "Abbrechen",
        "ui.cannotAfford": "Zu teuer",
        "ui.tower": "Turm",
        "ui.stats": "Werte",
        "ui.damage": "Schaden",
        "ui.range": "Reichweite",
        "ui.fireRate": "Feuerrate",
        "ui.slowdown": "Verlangsamung",
        "ui.duration": "Dauer",
        "ui.splashRadius": "Splash-Radius",
        "ui.targets": "Ziele",
        "ui.chainRange": "Sprungreichw.",
        "ui.pierce": "Durchdringung",
        "ui.perSecond": "/s",

        // Map Names
        "map.map1.name": "Grüntal",
        "map.map2.name": "Felspass",
        "map.map3.name": "Sumpfland",

        // Tower Names & Descriptions
        "tower.basic.name": "Basis Turm",
        "tower.sniper.name": "Sniper Turm",
        "tower.slow.name": "Frost Turm",
        "tower.bomb.name": "Bomben Turm",
        "tower.lightning.name": "Blitz Turm",
        "upgrade.basic.0.name": "Doppelschuss",
        "upgrade.basic.1.name": "Schnellfeuer",
        "upgrade.basic.2.name": "Sturmgeschütz",
        "upgrade.sniper.0.name": "Verstärkter Schuss",
        "upgrade.sniper.1.name": "Präzisionsboost",
        "upgrade.sniper.2.name": "Durchschlagsgeschosse",
        "upgrade.slow.0.name": "Stärkere Verlangsamung",
        "upgrade.slow.1.name": "Verlängerte Verlangsamung",
        "upgrade.slow.2.name": "Tieffrost",
        "upgrade.bomb.0.name": "Größerer Radius",
        "upgrade.bomb.1.name": "Schwere Munition",
        "upgrade.bomb.2.name": "Streubombe",
        "upgrade.lightning.0.name": "Kettenblitz",
        "upgrade.lightning.1.name": "Dreifachblitz",
        "upgrade.lightning.2.name": "Gewittersturm",

        // Enemy Names
        "enemy.normal.name": "Bauer",
        "enemy.fast.name": "Späher",
        "enemy.tank.name": "Ritter",
        "enemy.boss.name": "Kriegsherr",
        "enemy.immune.name": "Hexer",
        "enemy.regen.name": "Kleriker",

        // Popups / Alerts
        "alert.invalidSaveData.title": "Ladefehler",
        "alert.invalidSaveData.body": "Ungültige Speicherdaten gefunden. Speicherstand eventuell beschädigt.",
        "alert.loadError.title": "Ladefehler",
        "alert.loadError.body": "Fehler beim Laden des Spiels: ",
        "alert.noSave.title": "Spiel laden",
        "alert.noSave.body": "Kein gespeichertes Spiel gefunden.",
        "alert.saveSuccess.title": "Spiel gespeichert",
        "alert.saveSuccess.body": "Spiel erfolgreich gespeichert!",
        "alert.saveError.title": "Speicherfehler",
        "alert.saveError.body": "Fehler beim Speichern des Spiels: ",
        "alert.loadSuccess.title": "Spiel geladen",
        "alert.loadSuccess.body": "Spiel erfolgreich geladen!",
        "alert.gameOver.title": "Game Over!",
        "alert.gameOver.body": "Du hast Welle {waveNumber} erreicht.",
        "alert.cannotPlaceTower.title": "Platzierungsfehler",
        "alert.cannotPlaceTower.body": "Turm kann hier nicht platziert werden!",
        "alert.notEnoughGold.title": "Nicht genug Gold",
        "alert.notEnoughGold.body": "Du hast nicht genug Gold für diesen Turm.",
        "alert.cannotSwitchMap.title": "Kartenwechsel blockiert",
        "alert.cannotSwitchMap.body": "Karte kann nicht während einer laufenden Welle gewechselt werden!",
        "alert.upgradeFailed.title": "Upgrade fehlgeschlagen",
        "alert.upgradeFailed.body": "Upgrade fehlgeschlagen oder nicht möglich.",

        // Help Popup
        "help.title": "Spielanleitung",
        "help.close": "Schließen",
        "help.goal.title": "Ziel",
        "help.goal.body": "Verhindere, dass Gegner das Ende des Pfades erreichen! Platziere Türme strategisch, um sie zu besiegen.",
        "help.controls.title": "Steuerung",
        "help.controls.body": "<b>Klick auf leeres Feld:</b> Turmbau-Menü öffnen.<br><b>Klick auf Turm:</b> Upgrade/Verkaufen-Panel öffnen.<br><b>Rechtsklick / Klick außerhalb Menüs:</b> Menüs schließen.",
        "help.resources.title": "Ressourcen",
        "help.resources.body": "<b>{goldIcon} Gold:</b> Verdient durch Besiegen von Gegnern und Abschluss von Wellen. Wird für Bau und Upgrade von Türmen benötigt.<br><b>{livesIcon} Leben:</b> Verloren, wenn ein Gegner das Ende erreicht. Spiel vorbei, wenn Leben 0 erreicht.",
        "help.waves.title": "Wellen",
        "help.waves.body": "Klicke 'Welle starten', um die nächste Gegnerwelle zu beginnen. Nach Abschluss einer Welle startet die nächste automatisch nach einem kurzen Countdown.",
        "help.towers.title": "Türme",
        "help.enemies.title": "Gegner",
        "help.saveLoad.title": "Speichern/Laden",
        "help.saveLoad.body": "Benutze die 'Speichern' und 'Laden' Buttons im Header-Menü, um deinen Fortschritt zu verwalten.",

        // Tower help descriptions
        "help.tower.basic.desc": "Ausgeglichener Angreifer. Upgrades fügen mehr Schüsse hinzu oder erhöhen Feuerrate.",
        "help.tower.sniper.desc": "Hoher Schaden, große Reichweite, langsame Feuerrate. Upgrades erhöhen Schaden, Reichweite und später Durchdringung.",
        "help.tower.slow.desc": "Verlangsamt Gegner und verursacht geringen Schaden. Upgrades erhöhen Stärke und Dauer der Verlangsamung.",
        "help.tower.bomb.desc": "Verursacht Flächenschaden. Upgrades erhöhen Schaden und Explosionsradius.",
        "help.tower.lightning.desc": "Feuert Blitze, die auf nahe Gegner überspringen. Upgrades treffen mehr Ziele.",

        // Enemy help descriptions
        "help.enemy.normal.desc": "Standardgegner.",
        "help.enemy.fast.desc": "Bewegt sich schnell, weniger Leben.",
        "help.enemy.tank.desc": "Langsam, aber sehr viel Leben.",
        "help.enemy.boss.desc": "Sehr stark, erscheint in bestimmten Wellen.",
        "help.enemy.immune.desc": "Kann nicht von Frosttürmen verlangsamt werden.",
        "help.enemy.regen.desc": "Heilt sich langsam über Zeit.",
    },
    es: {
        "game.title": "Medieval Defense",
        // UI Elements - *** PLEASE PROVIDE SPANISH TRANSLATIONS ***
        "ui.lives": "Vidas",
        "ui.gold": "Oro",
        "ui.wave": "Oleada",
        "ui.waveReady": "Listo",
        "ui.waveStart": "Iniciar Oleada",
        "ui.map": "Mapa",
        "ui.language": "Idioma",
        "ui.save": "Guardar",
        "ui.load": "Cargar",
        "ui.help": "Ayuda",
        "ui.close": "Cerrar",
        "ui.sell": "Vender",
        "ui.upgrade": "Mejorar",
        "ui.maxLevel": "Nivel Máx.",
        "ui.cost": "Coste",
        "ui.sellValue": "Valor Venta",
        "ui.towerInfo": "Info Torre",
        "ui.currentLevel": "Nivel",
        "ui.confirm": "Confirmar",
        "ui.cancel": "Cancelar",
        "ui.cannotAfford": "Muy caro",
        "ui.tower": "Torre",
        "ui.stats": "Estadísticas",
        "ui.damage": "Daño",
        "ui.range": "Alcance",
        "ui.fireRate": "Cadencia",
        "ui.slowdown": "Ralentización",
        "ui.duration": "Duración",
        "ui.splashRadius": "Radio Splash",
        "ui.targets": "Objetivos",
        "ui.chainRange": "Alcance Salto",
        "ui.pierce": "Perforación",
        "ui.perSecond": "/s",

        // Map Names
        "map.map1.name": "Valle Verde",
        "map.map2.name": "Paso Rocoso",
        "map.map3.name": "Pantano",

        // Tower Names & Descriptions
        "tower.basic.name": "Torre Básica",
        "tower.sniper.name": "Torre Francotirador",
        "tower.slow.name": "Torre de Hielo",
        "tower.bomb.name": "Torre de Bombas",
        "tower.lightning.name": "Torre de Rayos",
        "upgrade.basic.0.name": "Disparo Doble",
        "upgrade.basic.1.name": "Fuego Rápido",
        "upgrade.basic.2.name": "Cañón de Asalto",
        "upgrade.sniper.0.name": "Disparo Reforzado",
        "upgrade.sniper.1.name": "Mejora de Precisión",
        "upgrade.sniper.2.name": "Balas Perforantes",
        "upgrade.slow.0.name": "Ralentización Fuerte",
        "upgrade.slow.1.name": "Ralentización Extendida",
        "upgrade.slow.2.name": "Congelación Profunda",
        "upgrade.bomb.0.name": "Explosión Amplia",
        "upgrade.bomb.1.name": "Munición Pesada",
        "upgrade.bomb.2.name": "Bomba de Racimo",
        "upgrade.lightning.0.name": "Rayo en Cadena",
        "upgrade.lightning.1.name": "Rayo Triple",
        "upgrade.lightning.2.name": "Tormenta Eléctrica",

        // Enemy Names
        "enemy.normal.name": "Campesino",
        "enemy.fast.name": "Explorador",
        "enemy.tank.name": "Caballero",
        "enemy.boss.name": "Señor de la Guerra",
        "enemy.immune.name": "Hechicero",
        "enemy.regen.name": "Clérigo",

        // Popups / Alerts
        "alert.invalidSaveData.title": "Error de Carga",
        "alert.invalidSaveData.body": "Datos de guardado inválidos. El archivo podría estar corrupto.",
        "alert.loadError.title": "Error de Carga",
        "alert.loadError.body": "Error al cargar el juego: ",
        "alert.noSave.title": "Cargar Juego",
        "alert.noSave.body": "No se encontró partida guardada.",
        "alert.saveSuccess.title": "Juego Guardado",
        "alert.saveSuccess.body": "¡Juego guardado con éxito!",
        "alert.saveError.title": "Error al Guardar",
        "alert.saveError.body": "Error al guardar el juego: ",
        "alert.loadSuccess.title": "Juego Cargado",
        "alert.loadSuccess.body": "¡Juego cargado con éxito!",
        "alert.gameOver.title": "¡Fin del Juego!",
        "alert.gameOver.body": "Has llegado a la oleada {waveNumber}.",
        "alert.cannotPlaceTower.title": "Error de Colocación",
        "alert.cannotPlaceTower.body": "¡No se puede colocar la torre aquí!",
        "alert.notEnoughGold.title": "Oro Insuficiente",
        "alert.notEnoughGold.body": "No tienes suficiente oro para esta torre.",
        "alert.cannotSwitchMap.title": "Cambio de Mapa Bloqueado",
        "alert.cannotSwitchMap.body": "¡No se puede cambiar de mapa durante una oleada activa!",
        "alert.upgradeFailed.title": "Mejora Fallida",
        "alert.upgradeFailed.body": "La mejora falló o no es posible.",

        // Help Popup
        "help.title": "Cómo Jugar",
        "help.close": "Cerrar",
        "help.goal.title": "Objetivo",
        "help.goal.body": "¡Evita que los enemigos lleguen al final del camino! Coloca torres estratégicamente para derrotarlos.",
        "help.controls.title": "Controles",
        "help.controls.body": "<b>Clic en casilla vacía:</b> Abrir menú de construcción.<br><b>Clic en torre:</b> Abrir panel de mejora/venta.<br><b>Clic derecho / Clic fuera de menús:</b> Cerrar menús.",
        "help.resources.title": "Recursos",
        "help.resources.body": "<b>{goldIcon} Oro:</b> Se obtiene al derrotar enemigos y completar oleadas. Se usa para construir y mejorar torres.<br><b>{livesIcon} Vidas:</b> Se pierden cuando un enemigo llega al final. Fin del juego si las vidas llegan a 0.",
        "help.waves.title": "Oleadas",
        "help.waves.body": "Haz clic en 'Iniciar Oleada' para comenzar la siguiente oleada de enemigos. Tras limpiar una oleada, la siguiente comenzará automáticamente tras una breve cuenta atrás.",
        "help.towers.title": "Torres",
        "help.enemies.title": "Enemigos",
        "help.saveLoad.title": "Guardar/Cargar",
        "help.saveLoad.body": "Usa los botones 'Guardar' y 'Cargar' en el menú superior para gestionar tu progreso.",

        // Tower help descriptions
        "help.tower.basic.desc": "Atacante equilibrado. Mejoras añaden más disparos o mayor cadencia.",
        "help.tower.sniper.desc": "Alto daño, largo alcance, baja cadencia. Mejoras aumentan daño, alcance y eventualmente perforan objetivos.",
        "help.tower.slow.desc": "Ralentiza enemigos y causa daño menor. Mejoras aumentan la fuerza y duración de la ralentización.",
        "help.tower.bomb.desc": "Causa daño de área (splash). Mejoras aumentan el daño y radio de explosión.",
        "help.tower.lightning.desc": "Dispara rayos que saltan a enemigos cercanos. Mejoras golpean más objetivos.",

        // Enemy help descriptions
        "help.enemy.normal.desc": "Enemigo estándar.",
        "help.enemy.fast.desc": "Se mueve rápido, menos vida.",
        "help.enemy.tank.desc": "Lento pero con mucha vida.",
        "help.enemy.boss.desc": "Muy fuerte, aparece en oleadas específicas.",
        "enemy.immune.desc": "No puede ser ralentizado por Torres de Hielo.",
        "enemy.regen.desc": "Se cura lentamente con el tiempo.",
    },
};

let currentLanguage = 'de'; // Default language

// Global translation function
function t(key, replacements = {}) {
    let translation = translations[currentLanguage]?.[key] || translations['en']?.[key] || key;
    // Replace placeholders like {waveNumber}
    for (const placeholder in replacements) {
        translation = translation.replace(`{${placeholder}}`, replacements[placeholder]);
    }
    return translation;
}
// --- END OF FILE translations.js ---